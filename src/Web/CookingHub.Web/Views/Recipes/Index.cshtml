@using System.Web
@using CookingHub.Models.ViewModels.Recipes
@using System.Text.RegularExpressions;
@model RecipePageViewModel
@{
    this.ViewData["Title"] = "Recipes";
}

@{
    var prevDisabled = !Model.RecipesPaginated.HasPreviousPage ? "disabled" : "";
    var prevPage = !Model.RecipesPaginated.HasPreviousPage ? "1" : (Model.RecipesPaginated.PageIndex - 1).ToString();
    var nextDisabled = !Model.RecipesPaginated.HasNextPage ? "disabled" : "";
    var nextPage = !Model.RecipesPaginated.HasNextPage ? "1" : (Model.RecipesPaginated.PageIndex + 1).ToString();
}

@{
    var queryString = this.Context.Request.QueryString;

    bool hasQueryString = queryString.HasValue;
    bool isAllTabSelected = false;
    string queryParameter = string.Empty;

    if (hasQueryString)
    {
        var encodedQueryString = HttpUtility.UrlDecode(queryString.Value);

        string pattern = "categoryName=([^&#]+)";
        if (Regex.IsMatch(encodedQueryString, pattern))
        {
            queryParameter = Regex.Match(encodedQueryString, pattern).Value.Split("=")[1];
        }
        else
        {
            isAllTabSelected = true;
        }
    }
}

<!-- Start All Pages -->
<div class="all-page-title page-breadcrumb">
    <div class="container text-center">
        <div class="row">
            <div class="col-lg-12">
                <h1>Recipes</h1>
            </div>
        </div>
    </div>
</div>
<!-- End All Pages -->
<!-- Start Recipes -->
<div class="menu-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="heading-title text-center">
                    <h2>Recipes</h2>
                    <p>Find the perfect food and drink ideas for every ocassion, from weeknight dinners to holiday feasts</p>
                </div>
            </div>
        </div>

        <div class="row inner-menu-box">
            <div class="col-3">
                <div class="nav nav-pills" id="v-pills-tab" role="tabpanel" aria-orientation="vertical">
                    <div id="myTab" class="nav flex-column nav-tabs" role="tablist">
                        <a class="nav-link @(!hasQueryString || isAllTabSelected ? "active" : "")">All</a>
                        @foreach (var category in Model.Categories)
                        {
                            <a class="nav-link @(category.Name == queryParameter ? "active" : "")"
                               asp-action="Index"
                               asp-route-categoryName="@category.Name">
                                @category.Name
                            </a>
                        }
                    </div>
                </div>
            </div>
            <div class="col-9">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                        <div class="row">
                            @if (Model.RecipesPaginated.Count != 0)
                            {
                                @foreach (var recipe in Model.RecipesPaginated)
                                {
                                    <div class="col-lg-4 col-md-6 recipe-card special-grid drinks">
                                        <div class="gallery-single fix">
                                            <img src="@recipe.ImagePath" class="img-fluid" alt="Image">
                                            <div class="why-text">
                                                <a asp-controller="Recipes" asp-action="Details" asp-route-id="@recipe.Id">
                                                    <h4>@recipe.Name</h4>
                                                </a>
                                                <p>@recipe.Rate</p>
                                                <h5>@recipe.Difficulty</h5>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="alert alert-danger" role="alert">
                                    We have no recipes provided for that category.
                                </div>
                            }
                        </div>
                    </div>
                </div>
                @if (Model.RecipesPaginated.TotalPages != 0)
                {
                    <div class="col-lg-12 col-md-6 mb-4">
                        <nav id="PaginationNav" aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item @prevDisabled">
                                    <a class="page-link" asp-action="Index" asp-route-pageNumber="@prevPage">
                                        Previous
                                    </a>
                                </li>
                                @for (int i = 1; i <= Model.RecipesPaginated.TotalPages; i++)
                                {
                                    var active = i == Model.RecipesPaginated.PageIndex ? "active" : string.Empty;
                                    <li class="page-item @active">
                                        <a class="page-link"
                                           asp-action="Index"
                                           asp-route-pageNumber="@i"
                                           asp-route-categoryName="@this.TempData["CategoryName"]">
                                            @i
                                    </a>
                                </li>
                            }
                                <li class="page-item @nextDisabled">
                                    <a class="page-link" asp-action="Index" asp-route-pageNumber="@nextPage">
                                        Next
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<!-- End Recipes -->
<!-- Start QT -->
<div class="qt-box qt-background">
    <div class="container">
        <div class="row">
            <div class="col-md-8 ml-auto mr-auto text-center">
                <p class="lead ">
                    " If you're not the one cooking, stay out of the way and compliment the chef. "
                </p>
                <span class="lead">Michael Strahan</span>
            </div>
        </div>
    </div>
</div>
<!-- End QT -->
<!-- Start Customer Reviews -->
<div class="customer-reviews-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="heading-title text-center">
                    <h2>Customer Reviews</h2>
                    <p>Lorem Ipsum is simply dummy text of the printing and typesetting</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8 mr-auto ml-auto text-center">
                <div id="reviews" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner mt-4">
                        <div class="carousel-item text-center active">
                            <div class="img-box p-1 border rounded-circle m-auto">
                                <img class="d-block w-100 rounded-circle" src="~/images/quotations-button.png" alt="">
                            </div>
                            <h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Paul Mitchel</strong></h5>
                            <h6 class="text-dark m-0">Web Developer</h6>
                            <p class="m-0 pt-3">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam eu sem tempor, varius quam at, luctus dui. Mauris magna metus, dapibus nec turpis vel, semper malesuada ante. Idac bibendum scelerisque non non purus. Suspendisse varius nibh non aliquet.</p>
                        </div>
                        <div class="carousel-item text-center">
                            <div class="img-box p-1 border rounded-circle m-auto">
                                <img class="d-block w-100 rounded-circle" src="~/images/quotations-button.png" alt="">
                            </div>
                            <h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Steve Fonsi</strong></h5>
                            <h6 class="text-dark m-0">Web Designer</h6>
                            <p class="m-0 pt-3">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam eu sem tempor, varius quam at, luctus dui. Mauris magna metus, dapibus nec turpis vel, semper malesuada ante. Idac bibendum scelerisque non non purus. Suspendisse varius nibh non aliquet.</p>
                        </div>
                        <div class="carousel-item text-center">
                            <div class="img-box p-1 border rounded-circle m-auto">
                                <img class="d-block w-100 rounded-circle" src="~/images/quotations-button.png" alt="">
                            </div>
                            <h5 class="mt-4 mb-0"><strong class="text-warning text-uppercase">Daniel vebar</strong></h5>
                            <h6 class="text-dark m-0">Seo Analyst</h6>
                            <p class="m-0 pt-3">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam eu sem tempor, varius quam at, luctus dui. Mauris magna metus, dapibus nec turpis vel, semper malesuada ante. Idac bibendum scelerisque non non purus. Suspendisse varius nibh non aliquet.</p>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#reviews" role="button" data-slide="prev">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#reviews" role="button" data-slide="next">
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Customer Reviews -->
<!-- Start Contact info -->
<div class="contact-imfo-box">
    <div class="container">
        <div class="row">
            <div class="col-md-4 arrow-right">
                <i class="fa fa-volume-control-phone"></i>
                <div class="overflow-hidden">
                    <h4>Phone</h4>
                    <p class="lead">
                        +01 123-456-4590
                    </p>
                </div>
            </div>
            <div class="col-md-4 arrow-right">
                <i class="fa fa-envelope"></i>
                <div class="overflow-hidden">
                    <h4>Email</h4>
                    <p class="lead">
                        yourmail@gmail.com
                    </p>
                </div>
            </div>
            <div class="col-md-4">
                <i class="fa fa-map-marker"></i>
                <div class="overflow-hidden">
                    <h4>Location</h4>
                    <p class="lead">
                        800, Lorem Street, US
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Contact info -->